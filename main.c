#include <stdint.h>
#include <string.h>
#include <stdbool.h>
#include <stm32f10x.h>

#define LCD_H 8
#define LCD_W 128
#define FONT_W 8
#define NUM_W 8
#define NUM_H 8

uint8_t LCD_buf[LCD_H*LCD_W] = {// 'template', 128x64px
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0x7f, 0xff, 0xff, 0xff, 0xff, 0x7f, 0xff, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0x18, 0x6b, 0x6b, 0x18, 0x6b, 0x68, 0xff, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0x21, 0xed, 0xed, 0xed, 0xed, 0x21, 0xff, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0x84, 0xbd, 0x85, 0xf5, 0xf5, 0x84, 0xff, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff};

const uint8_t numbers[10*NUM_W] = {0xff, 0xc3, 0xdb, 0xdb, 0xc3, 0xfb, 0xc3, 0xff, 0xff, 0xc3, 0xdb, 0xdb, 0xc3, 0xdb, 0xc3, 0xff, 
0xff, 0xc3, 0xfb, 0xf7, 0xef, 0xef, 0xef, 0xff, 0xff, 0xc3, 0xdf, 0xc7, 0xdb, 0xdb, 0xc3, 0xff, 
0xff, 0xc3, 0xdf, 0xdf, 0xe3, 0xfb, 0xc3, 0xff, 0xff, 0xdb, 0xdb, 0xdb, 0xc3, 0xfb, 0xfb, 0xff, 
0xff, 0xc3, 0xfb, 0xe7, 0xfb, 0xf3, 0xc7, 0xff, 0xff, 0xc3, 0xfb, 0xfb, 0xf7, 0xef, 0xc3, 0xff, 
0xff, 0xf7, 0xe7, 0xf7, 0xf7, 0xf7, 0xf7, 0xff, 0xff, 0xc3, 0xdb, 0xdb, 0xdb, 0xdb, 0xc3, 0xff};


const uint8_t font[256][FONT_W] = {
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x00
{0x7E,0x81,0xA9,0x8D,0x8D,0xA9,0x81,0x7E},	// 0x01
{0x7E,0xFF,0xD7,0xF3,0xF3,0xD7,0xFF,0x7E},	// 0x02
{0x70,0xF8,0xFC,0x7E,0xFC,0xF8,0x70,0x00},	// 0x03
{0x10,0x38,0x7C,0xFE,0x7C,0x38,0x10,0x00},	// 0x04
{0x1C,0x5C,0xF9,0xFF,0xF9,0x5C,0x1C,0x00},	// 0x05
{0x08,0x1C,0x3D,0xFF,0x3D,0x1C,0x08,0x00},	// 0x06
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x07
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x08
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x09
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x0A
{0x0E,0x1F,0x11,0x11,0xBF,0xFE,0xE0,0xF0},	// 0x0B
{0x00,0x72,0xFA,0x8F,0x8F,0xFA,0x72,0x00},	// 0x0C
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x0D
{0x03,0xFF,0xFE,0xA0,0xA0,0xA6,0xFE,0xFC},	// 0x0E
{0x99,0x5A,0x3C,0xE7,0xE7,0x3C,0x5A,0x99},	// 0x0F
{0xFE,0x7C,0x7C,0x38,0x38,0x10,0x10,0x00},	// 0x10
{0x10,0x10,0x38,0x38,0x7C,0x7C,0xFE,0x00},	// 0x11
{0x00,0x24,0x66,0xFF,0xFF,0x66,0x24,0x00},	// 0x12
{0x00,0xFA,0xFA,0x00,0x00,0xFA,0xFA,0x00},	// 0x13
{0x60,0xF0,0x90,0xFE,0xFE,0x80,0xFE,0xFE},	// 0x14
{0x5B,0xFD,0xA5,0xA5,0xBF,0x9A,0xC0,0x40},	// 0x15
{0x00,0x0E,0x0E,0x0E,0x0E,0x0E,0x0E,0x00},	// 0x16
{0x01,0x29,0x6D,0xFF,0xFF,0x6D,0x29,0x01},	// 0x17
{0x00,0x20,0x60,0xFE,0xFE,0x60,0x20,0x00},	// 0x18
{0x00,0x08,0x0C,0xFE,0xFE,0x0C,0x08,0x00},	// 0x19
{0x10,0x10,0x10,0x54,0x7C,0x38,0x10,0x00},	// 0x1A
{0x10,0x38,0x7C,0x54,0x10,0x10,0x10,0x00},	// 0x1B
{0x3C,0x3C,0x04,0x04,0x04,0x04,0x04,0x00},	// 0x1C
{0x10,0x38,0x7C,0x10,0x10,0x7C,0x38,0x10},	// 0x1D
{0x0C,0x1C,0x3C,0x7C,0x7C,0x3C,0x1C,0x0C},	// 0x1E
{0x60,0x70,0x78,0x7C,0x7C,0x78,0x70,0x60},	// 0x1F
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x20
{0x00,0x60,0xFA,0xFA,0x60,0x00,0x00,0x00},	// 0x21
{0x00,0xE0,0xE0,0x00,0xE0,0xE0,0x00,0x00},	// 0x22
{0x28,0xFE,0xFE,0x28,0xFE,0xFE,0x28,0x00},	// 0x23
{0x24,0x74,0xD6,0xD6,0x5C,0x48,0x00,0x00},	// 0x24
{0x62,0x66,0x0C,0x18,0x30,0x66,0x46,0x00},	// 0x25
{0x0C,0x5E,0xF2,0xBA,0xEC,0x5E,0x12,0x00},	// 0x26
{0x20,0xE0,0xC0,0x00,0x00,0x00,0x00,0x00},	// 0x27
{0x00,0x38,0x7C,0xC6,0x82,0x00,0x00,0x00},	// 0x28
{0x00,0x82,0xC6,0x7C,0x38,0x00,0x00,0x00},	// 0x29
{0x10,0x54,0x7C,0x38,0x38,0x7C,0x54,0x10},	// 0x2A
{0x10,0x10,0x7C,0x7C,0x10,0x10,0x00,0x00},	// 0x2B
{0x00,0x05,0x07,0x06,0x00,0x00,0x00,0x00},	// 0x2C
{0x10,0x10,0x10,0x10,0x10,0x10,0x00,0x00},	// 0x2D
{0x00,0x00,0x06,0x06,0x00,0x00,0x00,0x00},	// 0x2E
{0x06,0x0C,0x18,0x30,0x60,0xC0,0x80,0x00},	// 0x2F
{0x7C,0xFE,0x9A,0xB2,0xFE,0x7C,0x00,0x00},	// 0x30
{0x42,0x42,0xFE,0xFE,0x02,0x02,0x00,0x00},	// 0x31
{0x46,0xCE,0x9A,0x92,0xF6,0x66,0x00,0x00},	// 0x32
{0x44,0xC6,0x92,0x92,0xFE,0x6C,0x00,0x00},	// 0x33
{0x18,0x38,0x68,0xC8,0xFE,0xFE,0x08,0x00},	// 0x34
{0xE4,0xE6,0xA2,0xA2,0xBE,0x9C,0x00,0x00},	// 0x35
{0x3C,0x7E,0xD2,0x92,0x9E,0x0C,0x00,0x00},	// 0x36
{0xC0,0xC6,0x8E,0x98,0xF0,0xE0,0x00,0x00},	// 0x37
{0x6C,0xFE,0x92,0x92,0xFE,0x6C,0x00,0x00},	// 0x38
{0x60,0xF2,0x92,0x96,0xFC,0x78,0x00,0x00},	// 0x39
{0x00,0x00,0x36,0x36,0x00,0x00,0x00,0x00},	// 0x3A
{0x00,0x05,0x37,0x36,0x00,0x00,0x00,0x00},	// 0x3B
{0x10,0x38,0x6C,0xC6,0x82,0x00,0x00,0x00},	// 0x3C
{0x28,0x28,0x28,0x28,0x28,0x28,0x00,0x00},	// 0x3D
{0x00,0x82,0xC6,0x6C,0x38,0x10,0x00,0x00},	// 0x3E
{0x40,0xC0,0x8A,0x9A,0xF0,0x60,0x00,0x00},	// 0x3F
{0x7C,0xFE,0x82,0xBA,0xBA,0xF8,0x78,0x00},	// 0x40
{0x3E,0x7E,0xC8,0xC8,0x7E,0x3E,0x00,0x00},	// 0x41
{0x82,0xFE,0xFE,0x92,0x92,0xFE,0x6C,0x00},	// 0x42
{0x38,0x7C,0xC6,0x82,0x82,0xC6,0x44,0x00},	// 0x43
{0x82,0xFE,0xFE,0x82,0xC6,0xFE,0x38,0x00},	// 0x44
{0x82,0xFE,0xFE,0x92,0xBA,0x82,0xC6,0x00},	// 0x45
{0x82,0xFE,0xFE,0x92,0xB8,0x80,0xC0,0x00},	// 0x46
{0x38,0x7C,0xC6,0x82,0x8A,0xCE,0x4E,0x00},	// 0x47
{0xFE,0xFE,0x10,0x10,0xFE,0xFE,0x00,0x00},	// 0x48
{0x00,0x82,0xFE,0xFE,0x82,0x00,0x00,0x00},	// 0x49
{0x0C,0x0E,0x02,0x82,0xFE,0xFC,0x80,0x00},	// 0x4A
{0x82,0xFE,0xFE,0x10,0x38,0xEE,0xC6,0x00},	// 0x4B
{0x82,0xFE,0xFE,0x82,0x02,0x06,0x0E,0x00},	// 0x4C
{0xFE,0xFE,0x60,0x30,0x60,0xFE,0xFE,0x00},	// 0x4D
{0xFE,0xFE,0x60,0x30,0x18,0xFE,0xFE,0x00},	// 0x4E
{0x38,0x7C,0xC6,0x82,0xC6,0x7C,0x38,0x00},	// 0x4F
{0x82,0xFE,0xFE,0x92,0x90,0xF0,0x60,0x00},	// 0x50
{0x78,0xFC,0x84,0x8E,0xFE,0x7A,0x00,0x00},	// 0x51
{0x82,0xFE,0xFE,0x98,0x9C,0xF6,0x62,0x00},	// 0x52
{0x64,0xE6,0xB2,0x9A,0xDE,0x4C,0x00,0x00},	// 0x53
{0xC0,0x82,0xFE,0xFE,0x82,0xC0,0x00,0x00},	// 0x54
{0xFE,0xFE,0x02,0x02,0xFE,0xFE,0x00,0x00},	// 0x55
{0xF8,0xFC,0x06,0x06,0xFC,0xF8,0x00,0x00},	// 0x56
{0xFE,0xFE,0x0C,0x18,0x0C,0xFE,0xFE,0x00},	// 0x57
{0xC6,0xEE,0x38,0x10,0x38,0xEE,0xC6,0x00},	// 0x58
{0xE0,0xF2,0x1E,0x1E,0xF2,0xE0,0x00,0x00},	// 0x59
{0xE6,0xCE,0x9A,0xB2,0xE2,0xC6,0x8E,0x00},	// 0x5A
{0x00,0xFE,0xFE,0x82,0x82,0x00,0x00,0x00},	// 0x5B
{0x80,0xC0,0x60,0x30,0x18,0x0C,0x06,0x00},	// 0x5C
{0x00,0x82,0x82,0xFE,0xFE,0x00,0x00,0x00},	// 0x5D
{0x10,0x30,0x60,0xC0,0x60,0x30,0x10,0x00},	// 0x5E
{0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01},	// 0x5F
{0x00,0x00,0xC0,0xE0,0x20,0x00,0x00,0x00},	// 0x60
{0x04,0x2E,0x2A,0x2A,0x3C,0x1E,0x02,0x00},	// 0x61
{0x82,0xFC,0xFE,0x22,0x22,0x3E,0x1C,0x00},	// 0x62
{0x1C,0x3E,0x22,0x22,0x36,0x14,0x00,0x00},	// 0x63
{0x0C,0x1E,0x12,0x92,0xFC,0xFE,0x02,0x00},	// 0x64
{0x1C,0x3E,0x2A,0x2A,0x3A,0x18,0x00,0x00},	// 0x65
{0x12,0x7E,0xFE,0x92,0xC0,0x40,0x00,0x00},	// 0x66
{0x19,0x3D,0x25,0x25,0x1F,0x3E,0x20,0x00},	// 0x67
{0x82,0xFE,0xFE,0x10,0x20,0x3E,0x1E,0x00},	// 0x68
{0x00,0x22,0xBE,0xBE,0x02,0x00,0x00,0x00},	// 0x69
{0x02,0x23,0x21,0xBF,0xBE,0x00,0x00,0x00},	// 0x6A
{0x82,0xFE,0xFE,0x08,0x1C,0x36,0x22,0x00},	// 0x6B
{0x00,0x82,0xFE,0xFE,0x02,0x00,0x00,0x00},	// 0x6C
{0x3E,0x3E,0x30,0x18,0x30,0x3E,0x1E,0x00},	// 0x6D
{0x3E,0x3E,0x20,0x20,0x3E,0x1E,0x00,0x00},	// 0x6E
{0x1C,0x3E,0x22,0x22,0x3E,0x1C,0x00,0x00},	// 0x6F
{0x21,0x3F,0x1F,0x25,0x24,0x3C,0x18,0x00},	// 0x70
{0x18,0x3C,0x24,0x25,0x1F,0x3F,0x21,0x00},	// 0x71
{0x22,0x3E,0x1E,0x22,0x38,0x18,0x00,0x00},	// 0x72
{0x12,0x3A,0x2A,0x2A,0x2E,0x24,0x00,0x00},	// 0x73
{0x00,0x20,0x7C,0xFE,0x22,0x24,0x00,0x00},	// 0x74
{0x3C,0x3E,0x02,0x02,0x3C,0x3E,0x02,0x00},	// 0x75
{0x38,0x3C,0x06,0x06,0x3C,0x38,0x00,0x00},	// 0x76
{0x3C,0x3E,0x06,0x0C,0x06,0x3E,0x3C,0x00},	// 0x77
{0x22,0x36,0x1C,0x08,0x1C,0x36,0x22,0x00},	// 0x78
{0x39,0x3D,0x05,0x05,0x3F,0x3E,0x00,0x00},	// 0x79
{0x32,0x26,0x2E,0x3A,0x32,0x26,0x00,0x00},	// 0x7A
{0x10,0x10,0x7C,0xEE,0x82,0x82,0x00,0x00},	// 0x7B
{0x00,0x00,0x00,0xEE,0xEE,0x00,0x00,0x00},	// 0x7C
{0x82,0x82,0xEE,0x7C,0x10,0x10,0x00,0x00},	// 0x7D
{0x40,0xC0,0x80,0xC0,0x40,0xC0,0x80,0x00},	// 0x7E
{0x1E,0x3E,0x62,0xC2,0x62,0x3E,0x1E,0x00},	// 0x7F
{0x78,0xFD,0x87,0x86,0xCC,0x48,0x00,0x00},	// 0x80
{0x5C,0x5E,0x02,0x02,0x5E,0x5E,0x02,0x00},	// 0x81
{0x1C,0x3E,0x6A,0xEA,0xBA,0x18,0x00,0x00},	// 0x82
{0x40,0xC4,0xAE,0xAA,0xAA,0xBE,0xDE,0x42},	// 0x83
{0x84,0xAE,0x2A,0x2A,0xBE,0x9E,0x02,0x00},	// 0x84
{0x04,0xAE,0xEA,0x6A,0x3E,0x1E,0x02,0x00},	// 0x85
{0x00,0x44,0xEE,0xAA,0xAA,0xFE,0x5E,0x02},	// 0x86
{0x38,0x7D,0x47,0x46,0x6C,0x28,0x00,0x00},	// 0x87
{0x40,0xDC,0xBE,0xAA,0xAA,0xBA,0xD8,0x40},	// 0x88
{0x9C,0xBE,0x2A,0x2A,0xBA,0x98,0x00,0x00},	// 0x89
{0x1C,0xBE,0xEA,0x6A,0x3A,0x18,0x00,0x00},	// 0x8A
{0x80,0xA2,0x3E,0x3E,0x82,0x80,0x00,0x00},	// 0x8B
{0x40,0xC0,0xA2,0xBE,0xBE,0xC2,0x40,0x00},	// 0x8C
{0x00,0xA2,0xFE,0x7E,0x02,0x00,0x00,0x00},	// 0x8D
{0x9E,0xBE,0x64,0x64,0xBE,0x9E,0x00,0x00},	// 0x8E
{0x0E,0x5E,0xB4,0xB4,0x5E,0x0E,0x00,0x00},	// 0x8F
{0x22,0x3E,0x7E,0xEA,0xAA,0x22,0x00,0x00},	// 0x90
{0x04,0x2E,0x2A,0x2A,0x3E,0x3E,0x2A,0x2A},	// 0x91
{0x3E,0x7E,0xD0,0x90,0xFE,0xFE,0x92,0x00},	// 0x92
{0x4C,0xDE,0x92,0x92,0xDE,0x4C,0x00,0x00},	// 0x93
{0x4C,0x5E,0x12,0x12,0x5E,0x4C,0x00,0x00},	// 0x94
{0x0C,0x9E,0xD2,0x52,0x1E,0x0C,0x00,0x00},	// 0x95
{0x5C,0xDE,0x82,0x82,0xDE,0x5E,0x02,0x00},	// 0x96
{0x1C,0x9E,0xC2,0x42,0x1E,0x1E,0x02,0x00},	// 0x97
{0x5D,0x5D,0x05,0x05,0x5F,0x5E,0x00,0x00},	// 0x98
{0x9C,0xBE,0x22,0x22,0x22,0xBE,0x9C,0x00},	// 0x99
{0xBC,0xBE,0x02,0x02,0xBE,0xBC,0x00,0x00},	// 0x9A
{0x1C,0x3E,0x26,0x2A,0x32,0x3E,0x1C,0x00},	// 0x9B
{0x16,0x7E,0xFE,0x92,0xC2,0x66,0x04,0x00},	// 0x9C
{0x3A,0x7C,0xCE,0x92,0xE6,0x7C,0xB8,0x00},	// 0x9D
{0x22,0x36,0x1C,0x1C,0x36,0x22,0x00,0x00},	// 0x9E
{0x02,0x13,0x11,0x7F,0xFE,0x90,0xD0,0x40},	// 0x9F
{0x04,0x2E,0x6A,0xEA,0xBE,0x1E,0x02,0x00},	// 0xA0
{0x00,0x22,0x7E,0xFE,0x82,0x00,0x00,0x00},	// 0xA1
{0x0C,0x1E,0x12,0x52,0xDE,0x8C,0x00,0x00},	// 0xA2
{0x1C,0x1E,0x02,0x42,0xDE,0x9E,0x02,0x00},	// 0xA3
{0x5E,0xDE,0x90,0xD0,0x5E,0xCE,0x80,0x00},	// 0xA4
{0x5E,0xDE,0x98,0xCC,0x5E,0xDE,0x80,0x00},	// 0xA5
{0x00,0x64,0xF4,0x94,0xF4,0xF4,0x14,0x00},	// 0xA6
{0x00,0x64,0xF4,0x94,0x94,0xF4,0x64,0x00},	// 0xA7
{0x0C,0x1E,0xB2,0xA2,0x06,0x04,0x00,0x00},	// 0xA8
{0x38,0x44,0xBE,0xD2,0xDA,0xA6,0x44,0x38},	// 0xA9
{0x10,0x10,0x10,0x10,0x1C,0x1C,0x00,0x00},	// 0xAA
{0x86,0xFC,0xF8,0x33,0x77,0xD5,0x9D,0x09},	// 0xAB
{0x86,0xFC,0xF8,0x32,0x66,0xCE,0x9B,0x1F},	// 0xAC
{0x00,0x00,0x06,0x5F,0x5F,0x06,0x00,0x00},	// 0xAD
{0x10,0x38,0x6C,0x44,0x10,0x38,0x6C,0x44},	// 0xAE
{0x44,0x6C,0x38,0x10,0x44,0x6C,0x38,0x10},	// 0xAF
{0x55,0x00,0xAA,0x00,0x55,0x00,0xAA,0x00},	// 0xB0
{0x55,0xAA,0x55,0xAA,0x55,0xAA,0x55,0xAA},	// 0xB1
{0xAA,0xFF,0x55,0xFF,0xAA,0xFF,0x55,0xFF},	// 0xB2
{0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00},	// 0xB3
{0x08,0x08,0x08,0xFF,0xFF,0x00,0x00,0x00},	// 0xB4
{0x0E,0x1E,0x34,0x74,0xDE,0x8E,0x00,0x00},	// 0xB5
{0x4E,0x9E,0xB4,0xB4,0x9E,0x4E,0x00,0x00},	// 0xB6
{0x8E,0xDE,0x74,0x34,0x1E,0x0E,0x00,0x00},	// 0xB7
{0x38,0x44,0xBA,0xAA,0xAA,0x82,0x44,0x38},	// 0xB8
{0x28,0x28,0xEF,0xEF,0x00,0xFF,0xFF,0x00},	// 0xB9
{0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00},	// 0xBA
{0x28,0x28,0x2F,0x2F,0x20,0x3F,0x3F,0x00},	// 0xBB
{0x28,0x28,0xE8,0xE8,0x08,0xF8,0xF8,0x00},	// 0xBC
{0x18,0x3C,0x24,0xE7,0xE7,0x24,0x24,0x00},	// 0xBD
{0xD4,0xF4,0x3F,0x3F,0xF4,0xD4,0x00,0x00},	// 0xBE
{0x08,0x08,0x08,0x0F,0x0F,0x00,0x00,0x00},	// 0xBF
{0x00,0x00,0x00,0xF8,0xF8,0x08,0x08,0x08},	// 0xC0
{0x08,0x08,0x08,0xF8,0xF8,0x08,0x08,0x08},	// 0xC1
{0x08,0x08,0x08,0x0F,0x0F,0x08,0x08,0x08},	// 0xC2
{0x00,0x00,0x00,0xFF,0xFF,0x08,0x08,0x08},	// 0xC3
{0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08},	// 0xC4
{0x08,0x08,0x08,0xFF,0xFF,0x08,0x08,0x08},	// 0xC5
{0x44,0xEE,0xAA,0xEA,0x7E,0xDE,0x82,0x00},	// 0xC6
{0x4E,0xDE,0xB4,0xF4,0x5E,0xCE,0x80,0x00},	// 0xC7
{0x00,0x00,0xF8,0xF8,0x08,0xE8,0xE8,0x28},	// 0xC8
{0x00,0x00,0x3F,0x3F,0x20,0x2F,0x2F,0x28},	// 0xC9
{0x28,0x28,0xE8,0xE8,0x08,0xE8,0xE8,0x28},	// 0xCA
{0x28,0x28,0x2F,0x2F,0x20,0x2F,0x2F,0x28},	// 0xCB
{0x00,0x00,0xFF,0xFF,0x00,0xEF,0xEF,0x28},	// 0xCC
{0x28,0x28,0x28,0x28,0x28,0x28,0x28,0x28},	// 0xCD
{0x28,0x28,0xEF,0xEF,0x00,0xEF,0xEF,0x28},	// 0xCE
{0x66,0x3C,0x3C,0x24,0x3C,0x3C,0x66,0x00},	// 0xCF
{0xA0,0xE4,0x4E,0xEA,0xBE,0x1C,0x00,0x00},	// 0xD0
{0x92,0xFE,0xFE,0x92,0xC6,0xFE,0x38,0x00},	// 0xD1
{0x62,0xBE,0xBE,0xAA,0xAA,0x62,0x00,0x00},	// 0xD2
{0xA2,0xBE,0x3E,0x2A,0xAA,0xA2,0x00,0x00},	// 0xD3
{0x22,0xBE,0xFE,0x6A,0x2A,0x22,0x00,0x00},	// 0xD4
{0x50,0x70,0x10,0x00,0x00,0x00,0x00,0x00},	// 0xD5
{0x00,0x22,0x7E,0xFE,0xA2,0x00,0x00,0x00},	// 0xD6
{0x40,0xA2,0xBE,0xBE,0xA2,0x40,0x00,0x00},	// 0xD7
{0x80,0xA2,0x3E,0x3E,0xA2,0x80,0x00,0x00},	// 0xD8
{0x08,0x08,0x08,0xF8,0xF8,0x00,0x00,0x00},	// 0xD9
{0x00,0x00,0x00,0x0F,0x0F,0x08,0x08,0x08},	// 0xDA
{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF},	// 0xDB
{0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F},	// 0xDC
{0x00,0x00,0x00,0xEE,0xEE,0x00,0x00,0x00},	// 0xDD
{0x00,0xA2,0xFE,0x7E,0x22,0x00,0x00,0x00},	// 0xDE
{0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0},	// 0xDF
{0x1C,0x3E,0x62,0xE2,0xA2,0x3E,0x1C,0x00},	// 0xE0
{0x3F,0x7F,0x54,0x54,0x7C,0x28,0x00,0x00},	// 0xE1
{0x5C,0xBE,0xA2,0xA2,0xA2,0xBE,0x5C,0x00},	// 0xE2
{0x1C,0x3E,0xA2,0xE2,0x62,0x3E,0x1C,0x00},	// 0xE3
{0x4C,0xDE,0x92,0xD2,0x5E,0xCC,0x80,0x00},	// 0xE4
{0x5C,0xFE,0xA2,0xE2,0x62,0xFE,0x9C,0x00},	// 0xE5
{0x01,0x7F,0x7E,0x04,0x04,0x7C,0x78,0x00},	// 0xE6
{0x42,0x7E,0x7E,0x2A,0x38,0x10,0x00,0x00},	// 0xE7
{0x82,0xFE,0xFE,0xAA,0x28,0x38,0x10,0x00},	// 0xE8
{0x3C,0x3E,0x42,0xC2,0xBE,0x3C,0x00,0x00},	// 0xE9
{0x5C,0x9E,0x82,0x82,0x9E,0x5C,0x00,0x00},	// 0xEA
{0x3C,0xBE,0xC2,0x42,0x3E,0x3C,0x00,0x00},	// 0xEB
{0x1D,0x1D,0x45,0xC5,0x9F,0x1E,0x00,0x00},	// 0xEC
{0x30,0x3A,0x4E,0xCE,0xBA,0x30,0x00,0x00},	// 0xED
{0x40,0x40,0x40,0x40,0x40,0x40,0x00,0x00},	// 0xEE
{0x00,0x00,0x40,0xC0,0x80,0x00,0x00,0x00},	// 0xEF
{0x08,0x08,0x08,0x08,0x08,0x08,0x00,0x00},	// 0xF0
{0x22,0x22,0xFA,0xFA,0x22,0x22,0x00,0x00},	// 0xF1
{0x14,0x14,0x14,0x14,0x14,0x14,0x00,0x00},	// 0xF2
{0x8E,0xAC,0xF8,0x32,0x66,0xCE,0x9B,0x1F},	// 0xF3
{0x60,0xF0,0x90,0xFE,0xFE,0x80,0xFE,0xFE},	// 0xF4
{0x5B,0xFD,0xA5,0xA5,0xBF,0x9A,0xC0,0x40},	// 0xF5
{0x10,0x10,0xD6,0xD6,0x10,0x10,0x00,0x00},	// 0xF6
{0x00,0x01,0x03,0x02,0x00,0x00,0x00,0x00},	// 0xF7
{0x00,0x60,0xF0,0x90,0xF0,0x60,0x00,0x00},	// 0xF8
{0x40,0x40,0x00,0x00,0x40,0x40,0x00,0x00},	// 0xF9
{0x00,0x00,0x00,0x08,0x08,0x00,0x00,0x00},	// 0xFA
{0x00,0x48,0xC8,0xF8,0xF8,0x08,0x08,0x00},	// 0xFB
{0x00,0x88,0xA8,0xA8,0xF8,0xF8,0x50,0x00},	// 0xFC
{0x00,0x98,0xB8,0xA8,0xE8,0x48,0x00,0x00},	// 0xFD
{0x00,0x00,0x3C,0x3C,0x3C,0x3C,0x00,0x00},	// 0xFE
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00} 	// 0xFF
};

void delay_us(uint32_t us) {
	__asm volatile (
		"push {r0}\r\n"
		"mov R0, %0\r\n"
		"_loop:\r\n" //approx. 8ticks/iteration
			"cmp R0, #0\r\n"     //1
			"beq _exit\r\n"      //1 or 1+P (when condition is True)
			"sub R0, R0, #1\r\n" //1
			"nop\r\n" //1 allignment
			"b _loop\r\n" //1+P (pipeline refill) ~4 cycle
		"_exit:\r\n"
		"pop {r0}\r\n"
		:: "r"(9 * us) //for 72Mhz
	);
}

void SPI1_Write(uint8_t data){
	while( SPI1->SR & SPI_SR_BSY); 
	while( (SPI1->SR & SPI_SR_TXE) == 0);
	SPI1->DR = data;
	return;
}

uint8_t SPI1_Read(){
	while( (SPI1->SR & SPI_SR_RXNE) == 0 );
	return SPI1->DR;
}

void delay(uint32_t ticks) {
	for (int i=0; i<ticks; i++) {
		__NOP();
	}
}

void cmd(uint8_t data){ // Отправка команды
   GPIOA->ODR &= ~GPIO_ODR_ODR3; // A0=0 --указание на то, что отправляем команду
   GPIOA->ODR &= ~GPIO_ODR_ODR1; // CS=0 – указание дисплею, что данные адресованы ему
   SPI1_Write(data);
   while( SPI1->SR & SPI_SR_BSY);
   GPIOA->ODR |= GPIO_ODR_ODR1; // CS=1 – окончание передачи данных
}

void dat(uint8_t data){ // Отправка данных
   GPIOA->ODR |= GPIO_ODR_ODR3; // A0=1 --указание на то, что отправляем данные
   GPIOA->ODR &= ~GPIO_ODR_ODR1; // CS=0 – указание дисплею, что данные адресованы ему
   SPI1_Write(data);
   while( SPI1->SR & SPI_SR_BSY);
   GPIOA->ODR |= GPIO_ODR_ODR1; // CS=1 – окончание передачи данных
}

void SPI1_Init(){
	// Включить тактирование PORTA и SPI1
	RCC->APB2ENR |= RCC_APB2ENR_IOPAEN | RCC_APB2ENR_SPI1EN;

	// PA5 Alternate function Output
	GPIOA->CRL &= ~(GPIO_CRL_CNF5 | GPIO_CRL_MODE5);
	GPIOA->CRL |= GPIO_CRL_MODE5_0; // Mode='01' Output 10Mhz
	GPIOA->CRL |= GPIO_CRL_CNF5_1; // Alt function Push-pull

	// PA7 Alternate function Output
	GPIOA->CRL &= ~(GPIO_CRL_CNF7 | GPIO_CRL_MODE7);
	GPIOA->CRL |= GPIO_CRL_MODE7_0; // Mode='01' Output 10Mhz
	GPIOA->CRL |= GPIO_CRL_CNF7_1; // Alt function Push-pull

	// PA6 Alternate function Input
	GPIOA->CRL &= ~(GPIO_CRL_CNF6 | GPIO_CRL_MODE6);
	GPIOA->CRL |= GPIO_CRL_CNF6_1; // Input with pull-up

	// SPI1_BR = '011' Freq=F/16
	SPI1->CR1 &= ~ SPI_CR1_BR;
	SPI1->CR1 |= SPI_CR1_BR_0 | SPI_CR1_BR_1;

	SPI1->CR1 |= SPI_CR1_MSTR; // Master mode
	SPI1->CR1 |= SPI_CR1_SSM | SPI_CR1_SSI; // Software CS, Chip select = ON
	SPI1->CR1 |= SPI_CR1_CPOL; // CLK=1 when idle
	SPI1->CR1 |= SPI_CR1_CPHA; // Falling edge
	//SPI1->CR1 |= SPI_CR1_LSBFIRST; // Low significant bit first
	SPI1->CR1 &= ~SPI_CR1_DFF; // 8-bit data Frame

	// Включить SPI
	SPI1->CR1 |= SPI_CR1_SPE;
}

unsigned char reverse(unsigned char b) {
   b = (b & 0xF0) >> 4 | (b & 0x0F) << 4;
   b = (b & 0xCC) >> 2 | (b & 0x33) << 2;
   b = (b & 0xAA) >> 1 | (b & 0x55) << 1;
   return b;
}

void Display_Init(){
	// PA7 (MOSI) -> SI
	// PA5 (Clock) -> SCL
	// PA3 -> RS
	// PA2 -> RSE (reset)
	// PA1 -> CS (chip Select)
	// VSS -> GND (ground)
	// VDD -> +3V3
	SPI1_Init();
	// Настройка PORTA, PA1..3 на выход, General purpose output push-pull
	RCC->APB2ENR |= RCC_APB2ENR_IOPAEN;
	GPIOA->CRL &= ~(GPIO_CRL_CNF1 | GPIO_CRL_MODE1 | 
		GPIO_CRL_CNF2 | GPIO_CRL_MODE2 |
		GPIO_CRL_CNF3 | GPIO_CRL_MODE3);
	GPIOA->CRL |= GPIO_CRL_MODE1_0 |
		GPIO_CRL_MODE2_0 |
		GPIO_CRL_MODE3_0;
	// SPI1 CPOL=1, CPHA=1
	SPI1->CR1 |= SPI_CR1_CPOL; // CLK=1 when idle
	SPI1->CR1 |= SPI_CR1_CPHA; // Falling edge

   GPIOA->ODR &= ~GPIO_ODR_ODR1; // CS=0
   GPIOA->ODR &= ~GPIO_ODR_ODR2; // RESET=0 - аппаратный сброс
   delay_us(10000); // Wait for the power stabilized
   GPIOA->ODR |= GPIO_ODR_ODR2; // RESET=1
   delay_us(1000); // Wait <1ms

   cmd(0xA2); //LCD Drive set 1/9 bias
   cmd(0xA0); // RAM Address SEG Output normal
   cmd(0xC8); // Common output mode selection
   cmd(0x28 | 0x07); // Power control mode
   cmd(0x20 | 0x05); // Voltage regulator
   cmd(0xA6); // Normal color, A7 = inverse color
   cmd(0b10100000); // ADC Select
   cmd(0xAF); // Display on
   cmd(0b10100111); // Color invert mode
	
}

void Display_LoadBuf(){
	for(int i=0; i<LCD_H; i++){
		cmd(0b10110000 | i); // Page adress select
		cmd(0b00010000);
		cmd(0b00000000);
		for(int j=0; j<LCD_W; j++){
			dat(LCD_buf[i*LCD_W + j]);
		}
	}
}

void Display_LoadBufArea(int x, int y, int w, int h){
	for(int i=0; i<LCD_H; i++){
		cmd(0b10110000 | i); // Page adress select
		cmd(0b00010000);
		cmd(0b00000000);
		for(int j=0; j<LCD_W; j++){
			dat(LCD_buf[i*LCD_W + j]);
		}
	}
}

void Display_Print(char* Str, int StrLen, int x, int y){
	int x_safe = (x / 8) & 0x0F;
	int y_pos = y;
	for(int i=0; i<StrLen; i++){
		uint8_t c = Str[i];
		if(y_pos + FONT_W > LCD_W){
			x_safe = (x_safe+1) & 0x0F;
			y_pos = 0;
		}
		for(int j=0; j<FONT_W; j++){
			LCD_buf[x_safe*LCD_W+y_pos+j] = reverse(font[c][j]);
		}
		y_pos += FONT_W;
	}
	Display_LoadBuf();
}

void Display_DrawPixel(int x, int y, bool color){
	int x_safe = (x / 8) & 0x0F;
	if(color){
		LCD_buf[x_safe*LCD_W + y] |= (1 << (x%8));
	} else {
		LCD_buf[x_safe*LCD_W + y] &= ~(1 << (x%8));
	}
	Display_LoadBuf();
}

void Display_printScore(int score){
	// Начало цифры 'score':
	// &numbers[(9-score)*NUM_W]
	// длина цифры 'score' NUM_W байт
	int digit_number = 0;
	while( score > 0 ){
		int digit = score % 10;
		memcpy(&LCD_buf[digit_number*LCD_W], &numbers[(9-digit)*NUM_W], NUM_W);
		digit_number += 1;
		score = score / 10;
	}
	//Display_LoadBuf();
	Display_LoadBufArea(0,0,NUM_W,32);
}


int __attribute((noreturn)) main(void) {
	//RCC->APB2ENR |= 0b10000;
	// Включает тактирование PORTC, PORTB
	RCC->APB2ENR |= (RCC_APB2ENR_IOPCEN | RCC_APB2ENR_IOPBEN);
	// Настройка PORTC, PC13 на выход, General purpose output push-pull
	GPIOC->CRH = ~(GPIO_CRH_CNF13 | GPIO_CRH_MODE13) | GPIO_CRH_MODE13_0; 
	// Настройка PORTB, PB9 на вход с подтягивающим резистором
	GPIOB->CRH = ~(GPIO_CRH_CNF9 | GPIO_CRH_MODE9) | GPIO_CRH_CNF9_1;
	// Включение pull-up на PB9
	GPIOB->ODR |= GPIO_ODR_ODR9;
	// Запись логического 0 на выход PC13 (LED ON)
	GPIOC->ODR &= ~GPIO_ODR_ODR13;
	// Инициализация SPI1
	SPI1_Init();
	// Инициализация дисплея
	Display_Init();
	// Send LCD_Buf to display RAM
	Display_LoadBuf();

	//uint8_t MsgLen = 7;
	//char msg[] = "Very, VERY Long Message !!!!! 123456789";
	//Display_Print (&msg, sizeof(msg), 10, 100);

	//Display_DrawPixel(20,100, true);

	//Display_printScore(1);



    while (1) {
		for(int i=0; i<100; i++){
			Display_printScore(i);
			delay_us(300000);
		}


		if(GPIOB->IDR & GPIO_IDR_IDR9){ 
			GPIOC->ODR &= ~GPIO_ODR_ODR13; // LED ON
		} else { // Button is pressed
			GPIOC->ODR |= GPIO_ODR_ODR13; // LED OFF
		}
		// ToDo: delay_ms(1000)
    }
	
}
